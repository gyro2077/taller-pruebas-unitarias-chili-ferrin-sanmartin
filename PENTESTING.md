# Reporte Final de Pentesting: Cooperativa SoftSeguro

**Fecha:** 4 de Febrero, 2026
**Autor:** Antigravity (IA Assistant) & Gyro
**Objetivo:** Evaluar la seguridad de los microservicios `frontend`, `microservicio-cuentas` y `socios`.

---

## 1. Resumen Ejecutivo

Durante las pruebas de penetraci贸n realizadas al entorno de la Cooperativa (IP: `192.168.100.168`), se han identificado vulnerabilidades de severidad **ALTA** relacionadas con la l贸gica de negocio, as铆 como fallos de configuraci贸n de severidad **MEDIA/BAJA**.

El hallazgo m谩s cr铆tico permite a un atacante reducir el saldo de una cuenta (o destruir dinero) mediante transacciones de "dep贸sito" con montos negativos, lo cual evidencia una falta de validaci贸n de datos en el backend.

---

## 2. Alcance (Scope)

*   **Objetivo:** Servidor 192.168.100.168
*   **Servicios Evaluados:**
    *   NestJS (Cuentas) - Puerto 3000
    *   Spring Boot (Socios) - Puerto 8080
    *   Base de Datos MySQL - Puerto 3306
*   **Herramientas Utilizadas:** Nmap, Nikto, Curl, SQLMap, Gobuster.

---

## 3. Hallazgos y Resultados

### 3.1. Vulnerabilidad Cr铆tica: L贸gica de Negocio (Negative Deposit)
**Severidad:**  ALTA
**Descripci贸n:** El endpoint de dep贸sitos en el microservicio de cuentas (`POST /cuentas/{id}/deposito`) acepta valores monetarios negativos. Esto permite realizar una operaci贸n aritm茅tica inversa: en lugar de sumar saldo, lo resta.

**Evidencia:**
Se realiz贸 una petici贸n `POST` enviando `{"monto": -500}` a una cuenta con saldo `14500`.
El sistema proces贸 la solicitud exitosamente y el nuevo saldo fue `14000`.

```json
// Saldo Inicial
"saldo": 14500

// Inyecci贸n de Payload
curl -X POST ... -d '{"monto": -500}'

// Respuesta del Servidor (Saldo reducido)
"saldo": 14000
```

**Impacto:** P茅rdida de integridad en los datos financieros, posible fraude, o Denegaci贸n de Servicio (DoS) financiera al vaciar cuentas ajenas si se conocen los IDs.

**Recomendaci贸n:** Implementar validaci贸n en el DTO (Data Transfer Object) y en la capa de servicio para asegurar que `monto > 0`.

---

### 3.2. Exposici贸n de Servicios de Base de Datos
**Severidad:**  MEDIA
**Descripci贸n:** El servicio MySQL (puerto 3306) y MySQL X (33060) est谩n expuestos a toda la red.
**Impacto:** Aumenta la superficie de ataque. Si las credenciales son d茅biles (fuerza bruta), un atacante podr铆a comprometer toda la base de datos directamente, salt谩ndose las capas de aplicaci贸n.
**Recomendaci贸n:** Configurar el firewall (iptables/ufw) para permitir acceso al puerto 3306 solo desde `ocalhost` o IPs de confianza (los microservicios).

---

### 3.3. Configuraciones de Seguridad HTTP Faltantes
**Severidad:**  BAJA
**Descripci贸n:** Las herramientas de escaneo (Nikto) reportan la ausencia de cabeceras de seguridad importantes en ambos servidores web (Puertos 3000 y 8080).
*   Falta `X-Frame-Options` (Riesgo de Clickjacking).
*   Falta `X-Content-Type-Options` (Riesgo de MIME-sniffing).

**Recomendaci贸n:** Configurar Helmet en NestJS/Express y Spring Security Headers en Java.

---

### 3.4. M茅todos HTTP Inseguros Habilitados
**Severidad:**  BAJA
**Descripci贸n:** Se detect贸 que m茅todos como `PUT` y `DELETE` est谩n habilitados y expuestos p煤blicamente sin aparente restricci贸n de red (aunque pueden requerir autenticaci贸n a nivel de app, su exposici贸n es innecesaria si no son p煤blicos).

---

## 4. Pruebas Realizadas (Resumen T茅cnico)

### 4.1. Conectividad y Escaneo de Puertos
*   **Ping:** Exitosa, latencia < 1ms.
*   **Nmap:**
    *   `3000/tcp`: Node.js Express (API Cuentas/Frontend).
    *   `8080/tcp`: Apache Tomcat (API Socios).
    *   `3306/tcp`: MySQL.

### 4.2. An谩lisis de Vulnerabilidades Web
*   **Nikto:** Identific贸 ausencia de headers. Los reportes de XSS en "Mambo" son falsos positivos debido a la identificaci贸n err贸nea del servidor, pero la falta de headers es real.
*   **Gobuster:** No se encontraron directorios ocultos cr铆ticos con diccionarios est谩ndar.

### 4.3. Inyecci贸n SQL (SQL Injection)
*   **Herramienta:** SQLMap
*   **Objetivo:** Endpoint `/api/socios/identificacion/`
*   **Resultado:** Fallido. El servidor respondi贸 con errores 500 pero no mostr贸 vulnerabilidad inyectable detectable por la herramienta. Esto sugiere que el uso de JPA/Hibernate est谩 protegiendo correctamente las consultas b谩sicas, o el WAF/Validaci贸n est谩 activo.
*   **Imagen de Referencia:** `img_pentest/xss_no_valid.png` confirma que intentos manuales de inyecci贸n (XSS/SQLi) no fueron exitosos en el frontend, mostrando validaciones activas.

---

## 5. Conclusi贸n
El sistema presenta una postura de seguridad mixta. Aunque las inyecciones t茅cnicas cl谩sicas (SQLi) parecen mitigadas por el framework, la **L贸gica de Negocio** es d茅bil. La capacidad de realizar transacciones negativas es un fallo cr铆tico que debe ser priorizado para correcci贸n inmediata.

Se recomienda proceder con el parcheo del microservicio de Cuentas (`CuentasService`) y restringir el acceso a nivel de red para la base de datos.